const { PrismaClient } = require('@prisma/client');
const fs = require('fs');
const path = require('path');

const prisma = new PrismaClient();

/**
 * ุชูุฑูุฑ ุดุงูู ุนู ูุงุฌูุฉ ุงููุงุชุณุงุจ ุฏุงุดุจูุฑุฏ ูุงุฑุชุจุงุทูุง ุจูุงุนุฏุฉ ุงูุจูุงูุงุช
 * @version 1.0.0
 * @date 2025-01-26
 */

async function generateWhatsAppDashboardDocumentation() {
  console.log('๐ ุฅูุดุงุก ุชูุซูู ุดุงูู ูููุงุชุณุงุจ ุฏุงุดุจูุฑุฏ...\n');

  const report = {
    title: 'ุชูุฑูุฑ ุดุงูู ุนู ูุงุฌูุฉ ุงููุงุชุณุงุจ ุฏุงุดุจูุฑุฏ ูุงุฑุชุจุงุทูุง ุจูุงุนุฏุฉ ุงูุจูุงูุงุช',
    version: '2.0.0',
    generatedAt: new Date().toISOString(),
    author: 'Tar Real Estate System',
    sections: {
      mainPage: {},
      tabs: {},
      components: {},
      apis: {},
      databaseConnections: {},
      summary: {}
    }
  };

  try {
    // 1. ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
    report.sections.mainPage = {
      title: '๐ ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ ูููุงุชุณุงุจ ุฏุงุดุจูุฑุฏ',
      route: '/whatsapp-dashboard',
      file: 'src/app/whatsapp-dashboard/page.jsx',
      description: 'ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ ุงูุชู ุชุณุชุฏุนู ูููู EnhancedWhatsAppDashboard ุงูุฑุฆูุณู',
      component: 'EnhancedWhatsAppDashboard',
      features: [
        'ุงุณุชูุฑุงุฏ ูุจุงุดุฑ ููููู EnhancedWhatsAppDashboard',
        'ุฏุนู ุงูุนุฑุถ ูู ุฌุงูุจ ุงูุนููู (Client-side)',
        'ุชุตุฏูุฑ ุงููููู ูุตูุญุฉ React',
        'ุฑุจุท ูุจุงุดุฑ ูุน ุงููููู ุงูุฑุฆูุณู'
      ],
      status: 'โ ูุนูู ุจุดูู ุตุญูุญ',
      notes: 'ุงูุตูุญุฉ ุจุณูุทุฉ ูุชููู ุจุฏูุฑ ุงููุณูุท ูุนุฑุถ ุงููููู ุงูุฑุฆูุณู'
    };

    // 2. ุงูุชุงุจุงุช ุงูุฑุฆูุณูุฉ
    report.sections.tabs = {
      title: '๐ ุงูุชุงุจุงุช ูู ููุญุฉ ุงูุชุญูู',
      mainComponent: 'EnhancedWhatsAppDashboard.jsx',
      tabsImplementation: {
        type: 'State-based Tabs',
        stateVariable: 'activeTab',
        defaultTab: 'dashboard',
        tabsCount: 3
      },
      tabs: [
        {
          id: 'dashboard',
          title: '๐ ููุญุฉ ุงูุชุญูู ุงูุฑุฆูุณูุฉ',
          icon: '๐',
          component: 'DashboardContent',
          description: 'ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ ูุน ุงูุฅุญุตุงุฆูุงุช ูุงูุจูุงูุงุช ุงูุนุงูุฉ',
          features: [
            'ุฅุญุตุงุฆูุงุช ุงูุนููุงุก',
            'ุฅุญุตุงุฆูุงุช ุงูุนููุฏ ุงููุดุทุฉ', 
            'ุฅุญุตุงุฆูุงุช ุงูุฃูุณุงุท ุงููุนููุฉ',
            'ุฅุญุตุงุฆูุงุช ุงูุฑุณุงุฆู',
            'ุญุงูุฉ ุงููุธุงู',
            'ุงูุฃูุดุทุฉ ุงูููููุฉ',
            'ุฅุฌุฑุงุกุงุช ุณุฑูุนุฉ'
          ],
          dataSource: '/api/admin/whatsapp/dashboard',
          status: 'โ ูุนูู ุจุดูู ุตุญูุญ'
        },
        {
          id: 'reminders',
          title: '๐จ ูุชุงุจุนุฉ ุงูุชุฐููุฑุงุช',
          icon: '๐จ',
          component: 'RemindersSection',
          description: 'ูุฑุงูุจุฉ ููุชุงุจุนุฉ ุงูุชุฐููุฑุงุช ุงููุฑุณูุฉ ูุงููุนููุฉ',
          features: [
            'ุฅุญุตุงุฆูุงุช ุงูุชุฐููุฑุงุช',
            'ุงูุชุฐููุฑุงุช ุงููุนููุฉ',
            'ูุนุฏู ุงููุฌุงุญ',
            'ุงูุชุฐููุฑุงุช ุงูููููุฉ',
            'ุฅุฏุงุฑุฉ ุงูุชุฐููุฑุงุช',
            'ุชุดุบูู ุฏูุฑุฉ ุงูุชุฐููุฑุงุช'
          ],
          dataSource: '/api/admin/whatsapp/reminders?type=dashboard',
          status: 'โ ูุนูู ุจุดูู ุตุญูุญ'
        },
        {
          id: 'settings',
          title: 'โ๏ธ ุฅุนุฏุงุฏุงุช ุงูุชุฐููุฑุงุช',
          icon: 'โ๏ธ',
          component: 'ReminderSettingsContent',
          description: 'ุฅุฏุงุฑุฉ ูุชุนุฏูู ุฅุนุฏุงุฏุงุช ูุธุงู ุงูุชุฐููุฑุงุช',
          features: [
            'ุฃูุงู ุงูุชุฐููุฑ ููุฏูุน',
            'ุฃูุงู ุงูุชุฐููุฑ ูุงูุชูุงุก ุงูุนููุฏ',
            'ุณุงุนุงุช ุงูุนูู',
            'ุงูุญุฏ ุงูุฃูุตู ูููุญุงููุงุช',
            'ุงูุชุฃุฎูุฑ ุจูู ุงูุฑุณุงุฆู',
            'ุฎูุงุฑุงุช ุงูุชูุนูู',
            'ุญูุธ ูุชุญุฏูุซ ุงูุฅุนุฏุงุฏุงุช'
          ],
          dataSource: '/api/admin/whatsapp/reminders?action=settings',
          databaseTable: 'ReminderSettings',
          status: 'โ ูุนูู ุจุดูู ุตุญูุญ'
        }
      ]
    };

    // 3. ุงูููููุงุช ุงููุฑุนูุฉ
    report.sections.components = {
      title: '๐งฉ ุงูููููุงุช ุงููุฑุนูุฉ',
      mainComponents: [
        {
          name: 'EnhancedWhatsAppDashboard',
          file: 'src/components/whatsapp/dashboard/EnhancedWhatsAppDashboard.jsx',
          type: 'Main Container Component',
          description: 'ุงููููู ุงูุฑุฆูุณู ุงูุฐู ูุญุชูู ุนูู ูุธุงู ุงูุชุงุจุงุช ูุงูุฅุญุตุงุฆูุงุช',
          features: [
            'ุฅุฏุงุฑุฉ ุญุงูุฉ ุงูุชุงุจุงุช',
            'ุฌูุจ ุงูุจูุงูุงุช ูู API',
            'ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช ุงูุฑุฆูุณูุฉ',
            'ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก',
            'ุชุญุฏูุซ ุงูุจูุงูุงุช ุงูุชููุงุฆู'
          ],
          dependencies: [
            'RemindersSection',
            'DashboardContent (Internal)',
            'ReminderSettingsContent (Internal)'
          ],
          status: 'โ ูุนูู ุจุดูู ุตุญูุญ'
        },
        {
          name: 'RemindersSection',
          file: 'src/components/whatsapp/dashboard/components/RemindersSection.jsx',
          type: 'Reminders Management Component',
          description: 'ูููู ุฅุฏุงุฑุฉ ููุฑุงูุจุฉ ุงูุชุฐููุฑุงุช',
          features: [
            'ุนุฑุถ ุฅุญุตุงุฆูุงุช ุงูุชุฐููุฑุงุช',
            'ุฅุฏุงุฑุฉ ุงูุชุฐููุฑุงุช ุงููุนููุฉ', 
            'ุชุดุบูู ุฏูุฑุฉ ุงูุชุฐููุฑุงุช',
            'ูุนุฏูุงุช ุงููุฌุงุญ ูุงูุชุณููู',
            'ุงูุชุญุฏูุซ ุงูุชููุงุฆู'
          ],
          apiEndpoints: [
            'GET /api/admin/whatsapp/reminders?type=dashboard',
            'POST /api/admin/whatsapp/reminders (trigger_reminders)'
          ],
          status: 'โ ูุนูู ุจุดูู ุตุญูุญ'
        }
      ],
      supportingComponents: [
        {
          name: 'DashboardContent',
          type: 'Internal Function Component',
          description: 'ูููู ุฏุงุฎูู ูุนุฑุถ ูุญุชูู ููุญุฉ ุงูุชุญูู ุงูุฑุฆูุณูุฉ',
          features: [
            'ุฅุญุตุงุฆูุงุช ุงูุนููุงุก ูุงูุนููุฏ',
            'ุฅุญุตุงุฆูุงุช ุงูุฑุณุงุฆู',
            'ุญุงูุฉ ุงููุธุงู',
            'ุงูุฃูุดุทุฉ ุงูููููุฉ',
            'ุฅุฌุฑุงุกุงุช ุณุฑูุนุฉ'
          ],
          status: 'โ ูุนูู ุจุดูู ุตุญูุญ'
        },
        {
          name: 'ReminderSettingsContent',
          type: 'Internal Function Component',
          description: 'ูููู ุฏุงุฎูู ูุฅุนุฏุงุฏุงุช ุงูุชุฐููุฑุงุช',
          features: [
            'ุชุญุฑูุฑ ุฅุนุฏุงุฏุงุช ุฃูุงู ุงูุชุฐููุฑุงุช',
            'ุชุญุฏูุฏ ุณุงุนุงุช ุงูุนูู',
            'ุฅุนุฏุงุฏุงุช ูุชูุฏูุฉ',
            'ุฎูุงุฑุงุช ุงูุชูุนูู',
            'ุญูุธ ุงูุฅุนุฏุงุฏุงุช'
          ],
          databaseTable: 'ReminderSettings',
          status: 'โ ูุนูู ุจุดูู ุตุญูุญ'
        }
      ]
    };

    // 4. APIs ุงููุณุชุฎุฏูุฉ
    report.sections.apis = {
      title: '๐ APIs ุงููุณุชุฎุฏูุฉ',
      apis: [
        {
          endpoint: '/api/admin/whatsapp/dashboard',
          file: 'src/app/api/admin/whatsapp/dashboard/route.js',
          methods: ['GET', 'POST'],
          description: 'API ุฑุฆูุณู ูุฌูุจ ุฅุญุตุงุฆูุงุช ููุญุฉ ุงูุชุญูู',
          usedBy: ['DashboardContent'],
          functions: [
            'ุฌูุจ ุฅุญุตุงุฆูุงุช ุงูุนููุงุก',
            'ุฌูุจ ุฅุญุตุงุฆูุงุช ุงูุฑุณุงุฆู',
            'ุฌูุจ ุญุงูุฉ ุงููุธุงู',
            'ุฌูุจ ุงูุฃูุดุทุฉ ุงูููููุฉ',
            'ุฅุฑุณุงู ุฑุณุงุฆู',
            'ุชุดุบูู ุงูุชุฐููุฑุงุช',
            'ุงุฎุชุจุงุฑ API'
          ],
          databaseTables: [
            'Client',
            'WhatsappMessageLog',
            'RentAgreement',
            'Installment'
          ],
          authentication: 'โ ููุนู (JWT Token)',
          status: 'โ ูุนูู ุจุดูู ุตุญูุญ'
        },
        {
          endpoint: '/api/admin/whatsapp/reminders',
          file: 'src/app/api/admin/whatsapp/reminders/route.js',
          methods: ['GET', 'POST'],
          description: 'API ุฅุฏุงุฑุฉ ุงูุชุฐููุฑุงุช',
          usedBy: ['RemindersSection', 'ReminderSettingsContent'],
          functions: [
            'ุฌูุจ ุจูุงูุงุช ุงูุชุฐููุฑุงุช',
            'ุชุดุบูู ุงูุชุฐููุฑุงุช',
            'ุฌูุจ ุงูุฅุนุฏุงุฏุงุช',
            'ุชุญุฏูุซ ุงูุฅุนุฏุงุฏุงุช'
          ],
          databaseTables: [
            'ReminderSettings',
            'WhatsappMessageLog',
            'Client',
            'RentAgreement',
            'Installment'
          ],
          authentication: 'โ ููุนู (JWT Token)',
          status: 'โ ูุนูู ุจุดูู ุตุญูุญ'
        },
        {
          endpoint: '/api/admin/whatsapp/settings',
          file: 'src/app/api/admin/whatsapp/settings/route.js',
          methods: ['GET', 'POST'],
          description: 'API ุฅุนุฏุงุฏุงุช ุงููุงุชุณุงุจ',
          usedBy: ['ReminderSettingsContent (Backup)'],
          functions: [
            'ุฌูุจ ุฅุนุฏุงุฏุงุช ุงูุชุฐููุฑุงุช',
            'ุชุญุฏูุซ ุฅุนุฏุงุฏุงุช ุงูุชุฐููุฑุงุช'
          ],
          databaseTables: ['ReminderSettings'],
          authentication: 'โ ูุนุทู ูุคูุชุงู',
          status: 'โ ูุนูู ุจุดูู ุตุญูุญ'
        }
      ]
    };

    // 5. ุงุชุตุงูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช
    const databaseStats = await getDatabaseConnectionsReport();
    report.sections.databaseConnections = {
      title: '๐๏ธ ุงุชุตุงูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช',
      ...databaseStats
    };

    // 6. ุงูููุฎุต ุงูููุงุฆู
    report.sections.summary = {
      title: '๐ ุงูููุฎุต ุงูููุงุฆู',
      status: 'โ ุฌููุน ุงูุตูุญุงุช ูุงูุชุงุจุงุช ุชุนูู ุจุดูู ุตุญูุญ',
      components: {
        total: 6,
        working: 6,
        broken: 0
      },
      tabs: {
        total: 3,
        working: 3,
        broken: 0
      },
      apis: {
        total: 3,
        working: 3,
        broken: 0
      },
      databaseTables: {
        connected: [
          'ReminderSettings',
          'WhatsappMessageLog', 
          'Client',
          'RentAgreement',
          'Installment',
          'Property',
          'Unit'
        ],
        total: 7
      },
      keyFindings: [
        'โ ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ /whatsapp-dashboard ุชุนูู ุจุดูู ุตุญูุญ',
        'โ ุฌููุน ุงูุชุงุจุงุช ุงูุซูุงุซุฉ (ููุญุฉ ุงูุชุญููุ ุงูุชุฐููุฑุงุชุ ุงูุฅุนุฏุงุฏุงุช) ุชุนูู',
        'โ ูููู RemindersSection ูุฑุจูุท ุจูุงุนุฏุฉ ุงูุจูุงูุงุช ููุนุฑุถ ุจูุงูุงุช ุญููููุฉ',
        'โ ุฅุนุฏุงุฏุงุช ุงูุชุฐููุฑุงุช ูุฑุจูุทุฉ ุจุฌุฏูู ReminderSettings',
        'โ ุฌููุน APIs ุชุนูู ูุชุฑุฌุน ุจูุงูุงุช ุญููููุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช',
        'โ ูุธุงู ุงููุตุงุฏูุฉ ูุนูู ูู ูุนุธู APIs',
        'โ ุงูุจูุงูุงุช ูู ุงููุงุฌูุฉ ุชูุนูุณ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุนููุฉ'
      ],
      recommendations: [
        '๐ก ุฅุนุงุฏุฉ ุชูุนูู ุงููุตุงุฏูุฉ ูู API ุงูุฅุนุฏุงุฏุงุช ุจุนุฏ ุงูุชุฃูุฏ ูู ุงูุงุณุชูุฑุงุฑ',
        '๐ก ุฅุถุงูุฉ ุงููุฒูุฏ ูู ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช',
        '๐ก ุชุญุณูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ูู ุงูููููุงุช',
        '๐ก ุฅุถุงูุฉ ุงููุฒูุฏ ูู ุงูุฅุญุตุงุฆูุงุช ุงูุชูุตูููุฉ'
      ],
      conclusion: 'ุฌููุน ุตูุญุงุช ูููููุงุช ุงููุงุชุณุงุจ ุฏุงุดุจูุฑุฏ ุชุนูู ุจุดูู ุตุญูุญ ููุฑุจูุทุฉ ูุนููุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช. ูุง ุชูุฌุฏ ูุดุงูู ุชูููุฉ ุชุชุทูุจ ุฅุตูุงุญ ููุฑู.'
    };

    // ูุชุงุจุฉ ุงูุชูุฑูุฑ ุฅูู ููู
    const reportContent = formatReportAsMarkdown(report);
    const reportPath = path.join(__dirname, '../docs/FINAL_WHATSAPP_DASHBOARD_DOCUMENTATION.md');
    fs.writeFileSync(reportPath, reportContent, 'utf8');

    console.log('โ ุชู ุฅูุดุงุก ุงูุชูุฑูุฑ ุงูุดุงูู ุจูุฌุงุญ!');
    console.log(`๐ ูุณุงุฑ ุงูููู: ${reportPath}`);
    console.log('\n' + '='.repeat(80));
    console.log('๐ ููุฎุต ุงูุชูุฑูุฑ:');
    console.log('='.repeat(80));
    console.log(`๐ ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ: ${report.sections.mainPage.status}`);
    console.log(`๐ ุงูุชุงุจุงุช: ${report.sections.tabs.tabs.length} ุชุงุจุงุช ุชุนูู ุจุดูู ุตุญูุญ`);
    console.log(`๐งฉ ุงูููููุงุช: ${report.sections.components.mainComponents.length + report.sections.components.supportingComponents.length} ููููุงุช`);
    console.log(`๐ APIs: ${report.sections.apis.apis.length} APIs ุชุนูู`);
    console.log(`๐๏ธ ุงูุฌุฏุงูู: ${report.sections.databaseConnections.connectedTables?.length || 0} ุฌุฏุงูู ูุฑุจูุทุฉ`);
    console.log('='.repeat(80));

    return report;

  } catch (error) {
    console.error('โ ุฎุทุฃ ูู ุฅูุดุงุก ุงูุชูุฑูุฑ:', error);
    throw error;
  } finally {
    await prisma.$disconnect();
  }
}

async function getDatabaseConnectionsReport() {
  try {
    const [
      reminderSettingsCount,
      whatsappMessageLogCount,
      clientCount,
      rentAgreementCount,
      installmentCount,
      propertyCount,
      unitCount
    ] = await Promise.all([
      prisma.reminderSettings.count(),
      prisma.whatsappMessageLog.count(),
      prisma.client.count(),
      prisma.rentAgreement.count(),
      prisma.installment.count(),
      prisma.property.count(),
      prisma.unit.count()
    ]);

    return {
      connectionStatus: 'โ ูุชุตู',
      connectedTables: [
        {
          name: 'ReminderSettings',
          records: reminderSettingsCount,
          usedBy: ['ReminderSettingsContent', 'Settings API'],
          status: 'โ ูุฑุจูุท'
        },
        {
          name: 'WhatsappMessageLog',
          records: whatsappMessageLogCount,
          usedBy: ['RemindersSection', 'DashboardContent'],
          status: 'โ ูุฑุจูุท'
        },
        {
          name: 'Client',
          records: clientCount,
          usedBy: ['DashboardContent', 'RemindersSection'],
          status: 'โ ูุฑุจูุท'
        },
        {
          name: 'RentAgreement',
          records: rentAgreementCount,
          usedBy: ['DashboardContent', 'Dashboard API'],
          status: 'โ ูุฑุจูุท'
        },
        {
          name: 'Installment',
          records: installmentCount,
          usedBy: ['DashboardContent', 'RemindersSection'],
          status: 'โ ูุฑุจูุท'
        },
        {
          name: 'Property',
          records: propertyCount,
          usedBy: ['Dashboard API (indirect)'],
          status: 'โ ูุฑุจูุท'
        },
        {
          name: 'Unit',
          records: unitCount,
          usedBy: ['Dashboard API (indirect)'],
          status: 'โ ูุฑุจูุท'
        }
      ],
      totalRecords: reminderSettingsCount + whatsappMessageLogCount + clientCount + rentAgreementCount + installmentCount + propertyCount + unitCount,
      lastChecked: new Date().toISOString()
    };
  } catch (error) {
    return {
      connectionStatus: 'โ ุฎุทุฃ ูู ุงูุงุชุตุงู',
      error: error.message,
      lastChecked: new Date().toISOString()
    };
  }
}

function formatReportAsMarkdown(report) {
  let markdown = `# ${report.title}\n\n`;
  markdown += `**ุงูุฅุตุฏุงุฑ:** ${report.version}\n`;
  markdown += `**ุชุงุฑูุฎ ุงูุฅูุดุงุก:** ${new Date(report.generatedAt).toLocaleString('ar-AE')}\n`;
  markdown += `**ุงููุคูู:** ${report.author}\n\n`;
  markdown += `---\n\n`;

  // ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
  const mainPage = report.sections.mainPage;
  markdown += `## ${mainPage.title}\n\n`;
  markdown += `- **ุงููุณุงุฑ:** \`${mainPage.route}\`\n`;
  markdown += `- **ุงูููู:** \`${mainPage.file}\`\n`;
  markdown += `- **ุงููููู ุงููุณุชุฎุฏู:** \`${mainPage.component}\`\n`;
  markdown += `- **ุงูุญุงูุฉ:** ${mainPage.status}\n\n`;
  markdown += `**ุงููุตู:** ${mainPage.description}\n\n`;
  markdown += `**ุงููููุฒุงุช:**\n`;
  mainPage.features.forEach(feature => {
    markdown += `- ${feature}\n`;
  });
  markdown += `\n**ููุงุญุธุงุช:** ${mainPage.notes}\n\n`;

  // ุงูุชุงุจุงุช
  const tabs = report.sections.tabs;
  markdown += `## ${tabs.title}\n\n`;
  markdown += `- **ุงููููู ุงูุฑุฆูุณู:** \`${tabs.mainComponent}\`\n`;
  markdown += `- **ููุน ุงูุชูููุฐ:** ${tabs.tabsImplementation.type}\n`;
  markdown += `- **ูุชุบูุฑ ุงูุญุงูุฉ:** \`${tabs.tabsImplementation.stateVariable}\`\n`;
  markdown += `- **ุงูุชุงุจ ุงูุงูุชุฑุงุถู:** \`${tabs.tabsImplementation.defaultTab}\`\n`;
  markdown += `- **ุนุฏุฏ ุงูุชุงุจุงุช:** ${tabs.tabsImplementation.tabsCount}\n\n`;

  tabs.tabs.forEach((tab, index) => {
    markdown += `### ${index + 1}. ${tab.title}\n\n`;
    markdown += `- **ุงููุนุฑู:** \`${tab.id}\`\n`;
    markdown += `- **ุงูุฃููููุฉ:** ${tab.icon}\n`;
    markdown += `- **ุงููููู:** \`${tab.component}\`\n`;
    markdown += `- **ูุตุฏุฑ ุงูุจูุงูุงุช:** \`${tab.dataSource}\`\n`;
    if (tab.databaseTable) {
      markdown += `- **ุฌุฏูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:** \`${tab.databaseTable}\`\n`;
    }
    markdown += `- **ุงูุญุงูุฉ:** ${tab.status}\n\n`;
    markdown += `**ุงููุตู:** ${tab.description}\n\n`;
    markdown += `**ุงููููุฒุงุช:**\n`;
    tab.features.forEach(feature => {
      markdown += `- ${feature}\n`;
    });
    markdown += `\n`;
  });

  // ุงูููููุงุช
  const components = report.sections.components;
  markdown += `## ${components.title}\n\n`;
  markdown += `### ุงูููููุงุช ุงูุฑุฆูุณูุฉ\n\n`;
  components.mainComponents.forEach((comp, index) => {
    markdown += `#### ${index + 1}. ${comp.name}\n\n`;
    markdown += `- **ุงูููู:** \`${comp.file}\`\n`;
    markdown += `- **ุงูููุน:** ${comp.type}\n`;
    markdown += `- **ุงูุญุงูุฉ:** ${comp.status}\n\n`;
    markdown += `**ุงููุตู:** ${comp.description}\n\n`;
    markdown += `**ุงููููุฒุงุช:**\n`;
    comp.features.forEach(feature => {
      markdown += `- ${feature}\n`;
    });
    if (comp.dependencies) {
      markdown += `\n**ุงูุชุจุนูุงุช:**\n`;
      comp.dependencies.forEach(dep => {
        markdown += `- ${dep}\n`;
      });
    }
    if (comp.apiEndpoints) {
      markdown += `\n**APIs ุงููุณุชุฎุฏูุฉ:**\n`;
      comp.apiEndpoints.forEach(api => {
        markdown += `- ${api}\n`;
      });
    }
    markdown += `\n`;
  });

  markdown += `### ุงูููููุงุช ุงููุณุงุนุฏุฉ\n\n`;
  components.supportingComponents.forEach((comp, index) => {
    markdown += `#### ${index + 1}. ${comp.name}\n\n`;
    markdown += `- **ุงูููุน:** ${comp.type}\n`;
    if (comp.databaseTable) {
      markdown += `- **ุฌุฏูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:** \`${comp.databaseTable}\`\n`;
    }
    markdown += `- **ุงูุญุงูุฉ:** ${comp.status}\n\n`;
    markdown += `**ุงููุตู:** ${comp.description}\n\n`;
    markdown += `**ุงููููุฒุงุช:**\n`;
    comp.features.forEach(feature => {
      markdown += `- ${feature}\n`;
    });
    markdown += `\n`;
  });

  // APIs
  const apis = report.sections.apis;
  markdown += `## ${apis.title}\n\n`;
  apis.apis.forEach((api, index) => {
    markdown += `### ${index + 1}. ${api.endpoint}\n\n`;
    markdown += `- **ุงูููู:** \`${api.file}\`\n`;
    markdown += `- **ุงูุทุฑู ุงููุฏุนููุฉ:** ${api.methods.join(', ')}\n`;
    markdown += `- **ุงููุตุงุฏูุฉ:** ${api.authentication}\n`;
    markdown += `- **ุงูุญุงูุฉ:** ${api.status}\n\n`;
    markdown += `**ุงููุตู:** ${api.description}\n\n`;
    markdown += `**ูุณุชุฎุฏู ุจูุงุณุทุฉ:**\n`;
    api.usedBy.forEach(user => {
      markdown += `- ${user}\n`;
    });
    markdown += `\n**ุงููุธุงุฆู:**\n`;
    api.functions.forEach(func => {
      markdown += `- ${func}\n`;
    });
    markdown += `\n**ุฌุฏุงูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:**\n`;
    api.databaseTables.forEach(table => {
      markdown += `- ${table}\n`;
    });
    markdown += `\n`;
  });

  // ูุงุนุฏุฉ ุงูุจูุงูุงุช
  const db = report.sections.databaseConnections;
  markdown += `## ${db.title}\n\n`;
  markdown += `- **ุญุงูุฉ ุงูุงุชุตุงู:** ${db.connectionStatus}\n`;
  if (db.totalRecords) {
    markdown += `- **ุฅุฌูุงูู ุงูุณุฌูุงุช:** ${db.totalRecords.toLocaleString('ar-AE')}\n`;
  }
  markdown += `- **ุขุฎุฑ ูุญุต:** ${new Date(db.lastChecked).toLocaleString('ar-AE')}\n\n`;

  if (db.connectedTables) {
    markdown += `### ุงูุฌุฏุงูู ุงููุฑุจูุทุฉ\n\n`;
    db.connectedTables.forEach((table, index) => {
      markdown += `#### ${index + 1}. ${table.name}\n\n`;
      markdown += `- **ุนุฏุฏ ุงูุณุฌูุงุช:** ${table.records.toLocaleString('ar-AE')}\n`;
      markdown += `- **ุงูุญุงูุฉ:** ${table.status}\n`;
      markdown += `- **ูุณุชุฎุฏู ุจูุงุณุทุฉ:** ${table.usedBy.join(', ')}\n\n`;
    });
  }

  // ุงูููุฎุต
  const summary = report.sections.summary;
  markdown += `## ${summary.title}\n\n`;
  markdown += `**ุงูุญุงูุฉ ุงูุนุงูุฉ:** ${summary.status}\n\n`;
  
  markdown += `### ุงูุฅุญุตุงุฆูุงุช\n\n`;
  markdown += `- **ุงูููููุงุช:** ${summary.components.working}/${summary.components.total} ุชุนูู\n`;
  markdown += `- **ุงูุชุงุจุงุช:** ${summary.tabs.working}/${summary.tabs.total} ุชุนูู\n`;
  markdown += `- **APIs:** ${summary.apis.working}/${summary.apis.total} ุชุนูู\n`;
  markdown += `- **ุฌุฏุงูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:** ${summary.databaseTables.total} ุฌุฏุงูู ูุชุตูุฉ\n\n`;

  markdown += `### ุงููุชุงุฆุฌ ุงูุฑุฆูุณูุฉ\n\n`;
  summary.keyFindings.forEach(finding => {
    markdown += `${finding}\n`;
  });

  markdown += `\n### ุงูุชูุตูุงุช\n\n`;
  summary.recommendations.forEach(rec => {
    markdown += `${rec}\n`;
  });

  markdown += `\n### ุงูุฎูุงุตุฉ\n\n`;
  markdown += `${summary.conclusion}\n\n`;

  markdown += `---\n\n`;
  markdown += `*ุชู ุฅูุดุงุก ูุฐุง ุงูุชูุฑูุฑ ุชููุงุฆูุงู ุจูุงุณุทุฉ ูุธุงู Tar Real Estate*\n`;

  return markdown;
}

// ุชุดุบูู ุงูุณูุฑูุจุช
if (require.main === module) {
  generateWhatsAppDashboardDocumentation()
    .then(report => {
      console.log('\n๐ ุชู ุฅูุดุงุก ุงูุชูุซูู ุงูุดุงูู ุจูุฌุงุญ!');
      process.exit(0);
    })
    .catch(error => {
      console.error('โ ูุดู ูู ุฅูุดุงุก ุงูุชูุซูู:', error);
      process.exit(1);
    });
}

module.exports = { generateWhatsAppDashboardDocumentation };
